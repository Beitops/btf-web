---
import { Picture } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
	src: ImageMetadata;
	alt: string;
	width?: number;
	height?: number;
	class?: string;
	loading?: 'lazy' | 'eager';
	quality?: number;
}

const {
	src,
	alt,
	width,
	height,
	class: className,
	loading = 'lazy',
	quality,
} = Astro.props;

// Detectar el formato original de la imagen desde ImageMetadata
const srcPath = src.src || '';
const lowerPath = srcPath.toLowerCase();
const isPngOrJpg = lowerPath.endsWith('.png') || 
				   lowerPath.endsWith('.jpg') || 
				   lowerPath.endsWith('.jpeg');

// Si es PNG o JPG, convertir automáticamente a AVIF y WebP con fallback al original
// El navegador elegirá el mejor formato soportado (AVIF > WebP > Original)
// Si no es PNG/JPG, usar el formato original sin conversión
const formats = isPngOrJpg ? ['avif', 'webp'] : undefined;
---

<Picture
	src={src}
	alt={alt}
	width={width}
	height={height}
	class={className}
	loading={loading}
	formats={formats}
	quality={quality}
/>
